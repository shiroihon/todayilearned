<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://shiroimon.kithub.f5.si/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/github.min.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/github-style.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/light.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/dark.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/syntax.css' />
    <title>[BigQuery] CLI - Today I Learned | KitHub</title>
    
    <link rel="icon" type="image/x-icon" href='../../images/github-mark.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <script type="text/javascript" src="https://shiroimon.kithub.f5.si/js/gist-dark-mode.js"></script>

    
    <meta name="description"
  content="🔍 Memos using CLI operations for each job type." />
<meta name="keywords"
  content='blog' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://shiroimon.kithub.f5.si/post/bigquery_cli/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="[BigQuery] CLI - Today I Learned | KitHub" />
<meta name="twitter:description"
  content="🔍 Memos using CLI operations for each job type." />
<meta name="twitter:site" content="https://shiroimon.kithub.f5.si/" />
<meta name="twitter:creator" content="shiro" />
<meta name="twitter:image"
  content="https://shiroimon.kithub.f5.si/">


<meta property="og:type" content="article" />
<meta property="og:title" content="[BigQuery] CLI - Today I Learned | KitHub">
<meta property="og:description"
  content="🔍 Memos using CLI operations for each job type." />
<meta property="og:url" content="https://shiroimon.kithub.f5.si/post/bigquery_cli/" />
<meta property="og:site_name" content="[BigQuery] CLI" />
<meta property="og:image"
  content="https://shiroimon.kithub.f5.si/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-09-01 21:43:34 &#43;0900 JST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://shiroimon.kithub.f5.si/">
        <img class="octicon" height="32" width="32" src="../../images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://shiroimon.kithub.f5.si/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="../../images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
<main>
    
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
    <div class="px-0">
    <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
    <div class="flex-auto min-width-0 width-fit mr-3">
    <div class="d-flex">
        
        <div class="d-none d-md-block">
            <a class="avatar mr-2 flex-shrink-0" href="https://shiroimon.kithub.f5.si/">
                <img class=" avatar-user"
                  src="../../images/avatar.png"
                  width="32"
                  height="32">
            </a>
        </div>
        
        <div class="d-flex flex-column">
            
            <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                <span class="author"><a href="https://shiroimon.kithub.f5.si/"></a></span>
                <span class="path-divider">/</span>
                <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px"><a href="https://shiroimon.kithub.f5.si/post/bigquery_cli/">[BigQuery] CLI</a></strong>
            </h1>
            
            <div class="note m-0">
                Created <relative-time datetime="Mon, 01 Sep 2025 21:43:34 &#43;0900" class="no-wrap">Mon, 01 Sep 2025 21:43:34 &#43;0900</relative-time>
                
                <span class="path-divider">|</span>
                Modified <relative-time datetime="Thu, 02 Oct 2025 00:30:36 &#43;0900" class="no-wrap">Thu, 02 Oct 2025 00:30:36 &#43;0900</relative-time>
                
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>

    
    <div class="container-lg px-3 new-discussion-timeline">
    <div class="repository-content gist-content">
    <div>
        <div class="js-gist-file-update-container js-task-list-container file-box">
        <div id="file-pytest" class="file my-2">
        
        <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
        <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
            
            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
            <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                <svg aria-hidden="true" viewBox="0 0 16 16" class="octicon octicon-list-unordered" height="16" width="16">
                    <path fill-rule="evenodd"
                        d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z">
                    </path>
                </svg>
            </summary>
            <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                    <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list"></div>
                </div>
            </details-menu>
            1825 Words
            <span class="path-divider">|</span>
            4 min
            </div>

            
            <div class="file-actions flex-order-2 pt-0">
                
                <div class="d-none d-md-flex">
                    
                    
                    
                    <a class="muted-link mr-3" href="../../tags/bigquery">
                        <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                            <path fill-rule="evenodd"
                                d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                            </path>
                        </svg>
                        BigQuery
                    </a>
                    
                    
                    
                    <a class="muted-link mr-3" href="../../tags/cli">
                        <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                            <path fill-rule="evenodd"
                                d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                            </path>
                        </svg>
                        CLI
                    </a>
                    
                    
                    
                    <a class="muted-link mr-3" href="../../tags/google-cloud">
                        <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                            <path fill-rule="evenodd"
                                d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                            </path>
                        </svg>
                        Google Cloud
                    </a>
                    
                    
                    
                </div>
                
            </div>
        </div>
        </div>

        
        <div class="Box-body px-5 pb-5" style="z-index: 1">
            <article class="markdown-body entry-content container-lg"><!-- Icon Badge -->
<h2 id="why">Why<a class="anchor" aria-hidden="true" href="#why"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h2>
<p><code>SSIA</code></p>
<h2 id="what">What<a class="anchor" aria-hidden="true" href="#what"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h2>
<p><a href="https://github.com/GoogleCloudPlatform/python-docs-samples/blob/main/notebooks/rendered/bigquery-command-line-tool.md">https://github.com/GoogleCloudPlatform/python-docs-samples/blob/main/notebooks/rendered/bigquery-command-line-tool.md</a></p>
<ul>
<li><a href="https://cloud.google.com/bigquery/docs/bq-command-line-tool?hl=ja">bq コマンドライン ツールを使ってみる</a></li>
<li><a href="https://cloud.google.com/bigquery/docs/reference/bq-cli-reference?hl=ja">bq コマンドライン ツール リファレンス</a></li>
<li><a href="https://codelabs.developers.google.com/codelabs/bigquery-cli?hl=ja#0">BigQuery 用の bq コマンドライン ツールを使用してデータを読み込んでクエリを実行する</a></li>
</ul>
<p>使用メリットと特徴</p>
<ul>
<li>自動化しやすい: シェルスクリプトやcronと連携可能</li>
<li>高速な操作: GUIよりも素早い操作が可能</li>
<li>再現性: コマンド履歴で操作を追跡可能</li>
<li>バッチ処理: 大量の一括操作に適している</li>
<li>CI/CD連携: GitHub Actionsなどと連携した自動デプロイ</li>
<li>ロマン: それがCLI</li>
</ul>
<h3 id="setup">Setup<a class="anchor" aria-hidden="true" href="#setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">% gcloud auth login
</span></span></code></pre></div><ul>
<li>cf. <a href="https://book-reviews.blog/install-bq-command/">bqコマンドをインストールする</a></li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 利用可能プロジェクト確認</span>
</span></span><span class="line"><span class="cl">% gcloud config list
</span></span><span class="line"><span class="cl"><span class="c1"># 現在設定プロジェクト確認</span>
</span></span><span class="line"><span class="cl">% gcloud config get-value project
</span></span></code></pre></div></li>
</ul>
<h3 id="execute">Execute<a class="anchor" aria-hidden="true" href="#execute"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># show job list</span>
</span></span><span class="line"><span class="cl">% bq ls -j
</span></span></code></pre></div><ul>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># if) BigQuery error in ls operation: Please provide a project ID.</span>
</span></span><span class="line"><span class="cl">% bq ls --project_id<span class="o">=</span>YOUR_PROJECT_ID -j
</span></span></code></pre></div></li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Set environment variable</span>
</span></span><span class="line"><span class="cl">% <span class="nb">export</span> <span class="nv">CLOUDSDK_CORE_PROJECT</span><span class="o">=</span>YOUR_PROJECT_ID
</span></span><span class="line"><span class="cl">% bq ls -j
</span></span></code></pre></div></li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Set default project</span>
</span></span><span class="line"><span class="cl">% gcloud config <span class="nb">set</span> project YOUR_PROJECT_ID
</span></span></code></pre></div></li>
<li>cf. <a href="https://qiita.com/ShuA/items/f610cf1ee620b578fba8#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E8%A6%8B%E3%82%8B">BigQueryで他のユーザの実行クエリを見る</a> Qiita</li>
</ul>
<h3 id="dataengineer編">DataEngineer編<a class="anchor" aria-hidden="true" href="#dataengineer編"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>データエンジニアが主に使用するbqコマンド：</p>
<ul>
<li><code>CREATE/REPLACE</code>: テーブル全体の再作成</li>
<li><code>LOAD --append</code>: データの追加投入</li>
<li><code>COPY/CLONE</code>: テーブルの複製</li>
<li><code>SELECT</code>: データの参照と集計</li>
</ul>
<pre tabindex="0"><code>（ほとんど使わない）: UPDATE/DELETE

∵ データエンジニアは「CRUDよりも再作成」「更新よりも追加」「ポイント操作よりもバッチ処理」という哲学で設計することが多く、
　このアプローチが「データの真実性」「再現性」「スケーラビリティ」を担保するため
  「データは不変（immutable）である」という考え方が、現代のデータエンジニアリングの基本原則になっている
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 既存テーブルと同スキーマで新規テーブル作成したい（本番テーブルを元に開発用テーブル作成）</span>
</span></span><span class="line"><span class="cl">% bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE TABLE my-project:dataset_dev.sales_partitioned
</span></span></span><span class="line"><span class="cl"><span class="s2">  LIKE my-project:dataset.sales_partitioned
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div><ul>
<li>※ <code>--nouse_legacy_sql</code> フラグが必要!（StandardSQLでないと「LIKE 句」使えない）</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># スキーマのバックアップ</span>
</span></span><span class="line"><span class="cl">% bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE TABLE my-project:backup.sales_20251224
</span></span></span><span class="line"><span class="cl"><span class="s2">  LIKE my-project:dataset.sales
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div></li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># テスト用テーブルの一括作成</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl"><span class="nv">TABLES</span><span class="o">=(</span><span class="s2">&#34;sales&#34;</span> <span class="s2">&#34;users&#34;</span> <span class="s2">&#34;products&#34;</span> <span class="s2">&#34;events&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> table in <span class="s2">&#34;</span><span class="si">${</span><span class="nv">TABLES</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Creating test table: </span><span class="nv">$table</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE TABLE my-project:test_dataset.</span><span class="si">${</span><span class="nv">table</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">  LIKE my-project:prod_dataset.</span><span class="si">${</span><span class="nv">table</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div></li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># テーブルメンテナンス</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># テーブルのコピー（バックアップ）</span>
</span></span><span class="line"><span class="cl">% bq cp my-project:dataset.production_table my-project:backup.table_<span class="k">$(</span>date +%Y%m%d<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 古いテーブルの削除</span>
</span></span><span class="line"><span class="cl">% bq rm -t -f my-project:backup.table_20231201
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># スキーマのみコピー（開発用）</span>
</span></span><span class="line"><span class="cl">% bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE TABLE my-project:dev.test_table
</span></span></span><span class="line"><span class="cl"><span class="s2">  LIKE my-project:prod.production_table
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># パーティションやクラスタリングもコピーしたい場合</span>
</span></span><span class="line"><span class="cl">bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE TABLE my-project:dataset_dev.sales_partitioned
</span></span></span><span class="line"><span class="cl"><span class="s2">  COPY my-project:dataset.sales_partitioned
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 自動化されたデータパイプライン</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 日次バッチ処理の自動化</span>
</span></span><span class="line"><span class="cl">bq query --nouse_legacy_sql --project_id<span class="o">=</span>my-project <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  INSERT INTO analytics.daily_sales (date, total_sales)
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    CURRENT_DATE() as date,
</span></span></span><span class="line"><span class="cl"><span class="s2">    SUM(sales_amount) as total_sales
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM transactions.daily
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE date = CURRENT_DATE() - 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 処理結果をチェック</span>
</span></span><span class="line"><span class="cl">bq show --format<span class="o">=</span>prettyjson analytics.daily_sales
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># テーブル管理とメタデータ操作</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># テーブル一覧の取得</span>
</span></span><span class="line"><span class="cl">bq ls --format<span class="o">=</span>json my-project:dataset
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># テーブルスキーマの確認</span>
</span></span><span class="line"><span class="cl">bq show --schema my-project:dataset.table_name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># テーブルのコピー（バックアップ）</span>
</span></span><span class="line"><span class="cl">bq cp my-project:dataset.original_table my-project:dataset.backup_table
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># パーティションテーブルの作成</span>
</span></span><span class="line"><span class="cl">bq query <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE TABLE my-project:dataset.sales_partitioned
</span></span></span><span class="line"><span class="cl"><span class="s2">  PARTITION BY DATE(transaction_timestamp)
</span></span></span><span class="line"><span class="cl"><span class="s2">  AS
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT * FROM my-project:dataset.sales_source
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># データ品質チェック</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># NULL値チェック</span>
</span></span><span class="line"><span class="cl">bq query --format<span class="o">=</span>csv <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    COUNTIF(column1 IS NULL) as null_count_column1,
</span></span></span><span class="line"><span class="cl"><span class="s2">    COUNTIF(column2 IS NULL) as null_count_column2
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM my-project:dataset.table_name
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> &gt; data_quality_check.csv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重複チェック</span>
</span></span><span class="line"><span class="cl">bq query <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT column1, COUNT(*) as duplicate_count
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM my-project:dataset.table_name
</span></span></span><span class="line"><span class="cl"><span class="s2">  GROUP BY column1
</span></span></span><span class="line"><span class="cl"><span class="s2">  HAVING COUNT(*) &gt; 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 🚨 クエリ実行監視</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 実行中のクエリ確認</span>
</span></span><span class="line"><span class="cl">bq ls -j
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 特定のクエリの詳細確認</span>
</span></span><span class="line"><span class="cl">bq show -j job_id
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 高コストクエリの監視</span>
</span></span><span class="line"><span class="cl">bq query <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    job_id,
</span></span></span><span class="line"><span class="cl"><span class="s2">    query,
</span></span></span><span class="line"><span class="cl"><span class="s2">    total_bytes_processed,
</span></span></span><span class="line"><span class="cl"><span class="s2">    total_bytes_billed
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM region-us.INFORMATION_SCHEMA.JOBS
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE creation_time &gt; TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 HOUR)
</span></span></span><span class="line"><span class="cl"><span class="s2">  ORDER BY total_bytes_billed DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">  LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 🚨 リソース使用状況の監視</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ストレージ使用量の確認</span>
</span></span><span class="line"><span class="cl">bq show --format<span class="o">=</span>prettyjson my-project:dataset
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># プロジェクトごとの使用量</span>
</span></span><span class="line"><span class="cl">bq ls --project_id<span class="o">=</span>my-project --format<span class="o">=</span>json
</span></span></code></pre></div><h4 id="crud操作の比較">CRUD操作の比較<a class="anchor" aria-hidden="true" href="#crud操作の比較"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h4>
<p>💻 ソフトウェアエンジニア（SE）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 頻繁にCRUD操作を行う
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;山田太郎&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;山田花子&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>📊 データエンジニア</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 基本的にバッチ処理（追加のみ）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">load_time</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">staging_users</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 更新はあまり行わない（イミュータブルな設計）
</span></span></span></code></pre></div><p>🎯 データエンジニアが使う操作</p>
<ol>
<li>Bulk Insert</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># GCSからの一括ロード</span>
</span></span><span class="line"><span class="cl">bq load --source_format<span class="o">=</span>CSV <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  my-project:dataset.sales <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  gs://my-bucket/sales/*.csv <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  schema.json
</span></span></code></pre></div><ol start="2">
<li>Merge（UPSERT）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 条件付きマージ（稀だが使う場合あり）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MERGE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">target_table</span><span class="w"> </span><span class="n">T</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">USING</span><span class="w"> </span><span class="n">source_table</span><span class="w"> </span><span class="n">S</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">MATCHED</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">value</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><ol start="3">
<li>テーブルスワップ</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># アトミックなテーブル入れ替え</span>
</span></span><span class="line"><span class="cl">bq query <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE OR REPLACE TABLE my-project:dataset.users_new LIKE my-project:dataset.users_old
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bq cp my-project:dataset.users_new my-project:dataset.production_users
</span></span></code></pre></div><ol start="4">
<li>パーティションの入れ替え</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 特定パーティションのみ更新
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">partitioned_table</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DELETE</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">partition_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">partitioned_table</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">partition_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">new_data</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="dataanalyist編">DataAnalyist編<a class="anchor" aria-hidden="true" href="#dataanalyist編"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># アドホック分析の高速化</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 簡易集計クエリの実行</span>
</span></span><span class="line"><span class="cl">bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    category,
</span></span></span><span class="line"><span class="cl"><span class="s2">    AVG(price) as avg_price,
</span></span></span><span class="line"><span class="cl"><span class="s2">    COUNT(*) as item_count
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM my-project:dataset.products
</span></span></span><span class="line"><span class="cl"><span class="s2">  GROUP BY 1
</span></span></span><span class="line"><span class="cl"><span class="s2">  ORDER BY avg_price DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 結果をCSVで出力</span>
</span></span><span class="line"><span class="cl">bq query --format<span class="o">=</span>csv --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT * FROM my-project:dataset.sales
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE date &gt;= &#39;2025-12-24&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> &gt; sales_2025.csv
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 定期レポート生成</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 日次レポートの自動生成</span>
</span></span><span class="line"><span class="cl">bq query --nouse_legacy_sql <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  EXPORT DATA OPTIONS(
</span></span></span><span class="line"><span class="cl"><span class="s2">    uri=&#39;gs://my-bucket/daily_report_*.csv&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s2">    format=&#39;CSV&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s2">    overwrite=true
</span></span></span><span class="line"><span class="cl"><span class="s2">  ) AS
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    DATE(timestamp) as date,
</span></span></span><span class="line"><span class="cl"><span class="s2">    user_id,
</span></span></span><span class="line"><span class="cl"><span class="s2">    COUNT(*) as events
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM my-project:dataset.events
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE DATE(timestamp) = CURRENT_DATE() - 1
</span></span></span><span class="line"><span class="cl"><span class="s2">  GROUP BY date, user_id
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># EDA(データ探索)とプロファイリング</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># カラムごとの基本統計量</span>
</span></span><span class="line"><span class="cl">bq query <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    MIN(price) as min_price,
</span></span></span><span class="line"><span class="cl"><span class="s2">    MAX(price) as max_price,
</span></span></span><span class="line"><span class="cl"><span class="s2">    AVG(price) as avg_price,
</span></span></span><span class="line"><span class="cl"><span class="s2">    STDDEV(price) as std_price
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM my-project:dataset.products
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># データ分布の確認</span>
</span></span><span class="line"><span class="cl">bq query <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SELECT
</span></span></span><span class="line"><span class="cl"><span class="s2">    FLOOR(price/100)*100 as price_range,
</span></span></span><span class="line"><span class="cl"><span class="s2">    COUNT(*) as product_count
</span></span></span><span class="line"><span class="cl"><span class="s2">  FROM my-project:dataset.products
</span></span></span><span class="line"><span class="cl"><span class="s2">  GROUP BY 1
</span></span></span><span class="line"><span class="cl"><span class="s2">  ORDER BY 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span>
</span></span></code></pre></div><ul>
<li><a href="https://qiita.com/chan-p/items/5c3e6c10ed68650e8da3">【BigQuery】bqコマンド チートシート</a> Qiita</li>
<li><a href="https://qiita.com/toshi772/items/6d1db7dce6ea6a8d999f">BigQueryのbqコマンドメモ</a> Qiita</li>
</ul>
</article>
        </div>
        </div>
        </div>
    </div>
        
        
        
        <div class="Box mt-3 position-relative">
        <div class="Box-body px-5 pb-5">
            <article class="markdown-body entry-content container-lg">
                <h2>See Also</h2>
                <ul class="mt-2">
                    
                    <li class="p-1">
                        <div>
                            <a href="../../post/bigquery_about_various_data_transfer/">[BigQuery] (Various) Data Transfer</a>
                            <time datetime="2025-04-03 11:11" class="no-wrap text-small ml-1">(2025-04-03 11:11)</time>
                        </div>
                        <div class="text-small text-gray mb-1 mt-1">Find out various data transfer methods starting from BigQuery.</div>
                    </li>
                    
                    <li class="p-1">
                        <div>
                            <a href="../../post/bigquery_about_information_schema/">[BigQuery] INFORMATION_SCHEMA</a>
                            <time datetime="2025-03-06 17:39" class="no-wrap text-small ml-1">(2025-03-06 17:39)</time>
                        </div>
                        <div class="text-small text-gray mb-1 mt-1">It&#39;s not good to know about data governance.</div>
                    </li>
                    
                    <li class="p-1">
                        <div>
                            <a href="../../post/bigquery_billing_how_works/">[BigQuery] Billing</a>
                            <time datetime="2024-08-16 20:35" class="no-wrap text-small ml-1">(2024-08-16 20:35)</time>
                        </div>
                        <div class="text-small text-gray mb-1 mt-1">Summarize billing mechanism, fee structure, and money-saving tips.</div>
                    </li>
                    
                    <li class="p-1">
                        <div>
                            <a href="../../post/bigquery_about_machine_learning/">[BigQuery] Machine Learning</a>
                            <time datetime="2025-03-14 17:31" class="no-wrap text-small ml-1">(2025-03-14 17:31)</time>
                        </div>
                        <div class="text-small text-gray mb-1 mt-1">Completed within DWH, allowing modeling and analysis through queries</div>
                    </li>
                    
                    <li class="p-1">
                        <div>
                            <a href="../../post/bigquery_data_analysis_on_preparation/">[BigQuery] Data analysis on preparation</a>
                            <time datetime="2025-03-03 22:23" class="no-wrap text-small ml-1">(2025-03-03 22:23)</time>
                        </div>
                        <div class="text-small text-gray mb-1 mt-1">I would like to prepare for data analysis using GoogleSQL inside BigQuery</div>
                    </li>
                    
                </ul>
            </article>
        </div>
        </div>
        
    </div>
    </div>
</main>
</div>

<script type="application/javascript" src='https://shiroimon.kithub.f5.si/js/toc.js'></script>
<link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/toc.css' />


<script
    src='https://shiroimon.kithub.f5.si/js/syntax-highlight-title.js'
    crossorigin="anonymous"
    type="application/javascript">
</script>
<link rel="stylesheet" href="../../css/syntax-highlight-title.css">







  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/gitalk.css'>
<script src='https://shiroimon.kithub.f5.si/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'Ov23li4bh2st9tQoquIu',
    clientSecret: 'a7f9702fcb30947b9359d89046ada17fadbca6b9',
    repo: 'todayilearned',
    owner: 'bnx-hirukawa',
    admin: ['bnx-hirukawa'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>

</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://shiroimon.kithub.f5.si/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://shiroimon.kithub.f5.si/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://shiroimon.kithub.f5.si/js/search.js'></script>



</html>